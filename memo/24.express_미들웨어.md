# 미들웨어

- body를 파싱할 때 사용할 수 있음
- 미들웨어가 조금 어렵게 보일 수 있지만 미들웨어는 Express 내 모든 것의 구성 요소일 뿐
- 요청-응답 생명주기 내에서 실행되는 함수일 뿐
- 즉, Express에 요청이 전달되는 순간부터 코드가 처리를 완료하고 응답을 내보낼 때까지 실행 됨
- 미들웨어는 입력되는 요청의 body를 파싱하고 요청 객체에 추가해 JavaScript 객체로 사용할 수 있게 만들어줌

# Morgan 미들웨어

- HTTP 요청을 터미널에 로그로 남겨 줌, 디버깅 할 때 매우 유용하기 때문에 앱을 개발할 때 많이 이용

- 설치후 불러오기

```js
// app.js

const morgan = require("morgan");
```

- 애플리케이션이 Morgan을 use하도록 설정

```js
app.use(morgan("tiny"));
```

- morgan이 실행되면 모든 route의 로그가 터미널에 기록됨

# 미들웨어 정의 하기

```js
app.use((req, res, next) => {
  console.log("!!!!");
  next(); // 다음 미들웨어를 호출
});
```

- 세 번째 매개변수 next는 자동으로 전달되며 보통 next라고 부르는 함수로 다음 미들웨어나 라우트 핸들러를 호출

# 미들웨어로 404 루트 설정

```js
app.use((req, res) => {
  res.send("Not Found");
});
```

- next는 호출할 필요 없음
- 왜냐하면 앱의 가장 마지막에 정의됐기 때문에 위 라우트들이 매칭되어 응답을 보내 주기를 종료하지 않았을 때만 실행 될 것이기 때문에
- 보통 미들웨어에서 next를 호출하면 라우트 핸들러에서 응답을 보내거나 렌더링하거나 리다이렉트를 하는 등 어떻게든 주기를 종료

- `send`대신 `res.status(404)`를 이용해 설정 가능
